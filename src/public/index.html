<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HMS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-SgOJa3DmI69IUzQ2PVdRZhwQ+dy64/BUtbMJw1MZ8t5HZApcHrRKUc4W0kG879m7" crossorigin="anonymous">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


</head>

<style>
    table {
        border-collapse: collapse;
        width: 100%;
    }

    table,
    th,
    td {
        border: 1px solid #000;
    }
</style>


<body>
    <div id="app">
        <div class="col mt-5 m-5">
            <!-- <div class="container">
                <div class="row ">
                    <div class="col">
                        <h2>Edge Server</h2>
                    </div>
                    <div class="col-sm-6 col-md-4 col-lg-3 mb-3">
                        <div class="card bg-light shadow-sm col" type="button" class="btn btn-primary" type="button"
                            @click="displayWaitingCost" data-bs-toggle="modal" data-bs-target="#metricsModal2">
                            <div class="card-body text-center">
                                <p class="card-text display-6 text-primary">
                                    Overall <br> Average
                                </p>
                                <p class="card-text text-muted small">Click to view</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div> -->
            <div class="row">
                <div class="col">
                    <div class="ml-3">
                        <div class="card shadow p-4">
                            <h2 class="fw-bold">Task Offloading Algorithm Comparison</h2>
                            <hr class="mb-3">
                            <p class="text-muted mb-4">Aggregate results based on minimizing the sum of Cost and Time
                                for each task.</p>

                            <div class="table-responsive">
                                <table class="table table-borderless align-middle" style="font-size: 1.1rem;">
                                    <thead>
                                        <tr>
                                            <th class="p-3">Metric</th>

                                            <th class="bg-primary text-white p-3">
                                                Cloud <br> Algorithm
                                            </th>


                                            <th class="bg-primary text-white p-3">
                                                Edge <br> Algorithm
                                            </th>

                                            <th class="bg-danger text-white p-3">
                                                Vendor <br>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="fw-bold py-3">Total Final Cost <br> (USD)</td>
                                            <td class="py-3 text-success fw-bold">${{ totalFinalTransmissionCostCloud }}
                                            </td>
                                            <td class="py-3 text-danger fw-bold">$ {{ totalFinalTransmissionCostEdge }}
                                            </td>
                                            <td class="py-3 text-danger fw-bold">$ {{ vendorTotalVendorCost }}</td>

                                        </tr>

                                        <tr>
                                            <td class="fw-bold py-3">Total Final Time <br> (Seconds)</td>
                                            <td class="py-3 text-info fw-bold">{{ totalFinalTransmissionTimeCloud }} s
                                            </td>
                                            <td class="py-3 text-info fw-bold">{{ totalFinalTransmissionTimeEdge }} s
                                            </td>
                                            <td class="py-3 text-info fw-bold">{{ vendorTotalVendorTime }} s</td>
                                        </tr>

                                        <tr>
                                            <td class="fw-bold py-3">Average Time <br> per Task (Seconds)</td>
                                            <td class="py-3 text-info fw-bold">{{ averageFinalTransmissionTimeCloud }} s
                                            </td>
                                            <td class="py-3 text-info fw-bold">{{ averageFinalTransmissionTimeEdge }} s
                                            </td>
                                            <td class="py-3 text-info fw-bold">{{ averageTotalVendorTime }} s</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <small class="text-muted mt-3">
                                *All results are the sum of optimal executions (Cloud OR Edge) for each task.
                            </small>
                        </div>
                    </div>
                </div>
                <div class="container col">

                    <div class="row">
                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card bg-light shadow-sm" type="button" @click="displayTransmissionTime"
                                data-bs-toggle="modal" data-bs-target="#metricsModal">
                                <div class="card-body text-center p-3">
                                    <p class="card-text h5 text-primary">
                                        Transmission <br> Time
                                    </p>
                                    <p class="card-text text-muted small">Click to view</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card bg-light shadow-sm" type="button" @click="displayTransmissionCost"
                                data-bs-toggle="modal" data-bs-target="#metricsModal">
                                <div class="card-body text-center p-3">
                                    <p class="card-text h5 text-primary">
                                        Transmission <br> Cost
                                    </p>
                                    <p class="card-text text-muted small">Click to view</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card bg-light shadow-sm" type="button" @click="displayExecutionsMetricsTime"
                                data-bs-toggle="modal" data-bs-target="#metricsModal">
                                <div class="card-body text-center p-3">
                                    <p class="card-text h5 text-primary">
                                        Execution <br> Time
                                    </p>
                                    <p class="card-text text-muted small">Click to view</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card bg-light shadow-sm" type="button" @click="displayExecutionsMetricsCost"
                                data-bs-toggle="modal" data-bs-target="#metricsModal">
                                <div class="card-body text-center p-3">
                                    <p class="card-text h5 text-primary">
                                        Execution <br> Cost
                                    </p>
                                    <p class="card-text text-muted small">Click to view</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card bg-light shadow-sm" type="button" @click="displayEnergyUsage"
                                data-bs-toggle="modal" data-bs-target="#metricsModal">
                                <div class="card-body text-center p-3">
                                    <p class="card-text h5 text-primary">
                                        Energy <br> Usage
                                    </p>
                                    <p class="card-text text-muted small">Click to view</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card bg-light shadow-sm" type="button" @click="displayEnergyCost"
                                data-bs-toggle="modal" data-bs-target="#metricsModal">
                                <div class="card-body text-center p-3">
                                    <p class="card-text h5 text-primary">
                                        Energy <br> Cost
                                    </p>
                                    <p class="card-text text-muted small">Click to view</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card bg-light shadow-sm" type="button" @click="displayWaitingTime"
                                data-bs-toggle="modal" data-bs-target="#metricsModal">
                                <div class="card-body text-center p-3">
                                    <p class="card-text h5 text-primary">
                                        Waiting <br> Time
                                    </p>
                                    <p class="card-text text-muted small">Click to view</p>
                                </div>
                            </div>
                        </div>

                        <div class="col-sm-6 col-md-4 mb-3">
                            <div class="card bg-light shadow-sm" type="button" @click="displayWaitingCost"
                                data-bs-toggle="modal" data-bs-target="#metricsModal">
                                <div class="card-body text-center p-3">
                                    <p class="card-text h5 text-primary">
                                        Waiting <br> Cost
                                    </p>
                                    <p class="card-text text-muted small">Click to view</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="modal fade" id="metricsModal" tabindex="-1" aria-labelledby="metricsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content border-0 rounded-4 shadow-lg overflow-hidden" v-if="dialogData">

                    <!-- Header -->
                    <div class="modal-header text-white py-2 px-3 border-0"
                        style="background: linear-gradient(135deg, #007bff, #00b4d8);">
                        <h3 class="modal-title fw-bold mb-0 d-flex align-items-center" id="metricsModalLabel"
                            style="font-size: 1.05rem;">
                            <i class="bi bi-bar-chart-line-fill me-2 fs-3"></i> {{ dialog_Heading }}
                        </h3>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                            aria-label="Close"></button>
                    </div>

                    <!-- Body -->
                    <div class="modal-body p-5" style="background: #f8fafc;">
                        <div class="row g-4 justify-content-center">

                            <!-- Cloud Metrics -->
                            <div class="col-md-4">
                                <div class="card h-100 rounded-4 border-0 shadow-sm"
                                    style="background: linear-gradient(180deg, #e3f2fd, #ffffff);">
                                    <div class="card-header bg-transparent border-0 text-primary fw-semibold pb-0">
                                        <h5 class="fw-bold" style="font-size: 1.3rem;">☁️ Cloud Metrics</h5>
                                    </div>
                                    <div class="card-body p-4">
                                        <p class="text-secondary small mt-3 border-top pt-3 fw-medium">Detailed Results
                                        </p>
                                        <ul class="list-group list-group-flush small"
                                            style="max-height: 200px; overflow-y: auto;">
                                            <template v-for="(item, index) in dialogData.results" :key="index">
                                                <li v-if="item.betterServer === 'Cloud'" class="list-group-item d-flex justify-content-between
                                                    align-items-center p-2 border-0 bg-transparent">
                                                    <span class="fw-medium text-truncate">{{ item.id }}</span>
                                                    <span
                                                        class="badge rounded-pill text-bg-primary-subtle text-primary px-3 py-2">{{
                                                        item.cloud }}</span>
                                                </li>
                                            </template>

                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Edge Metrics -->
                            <div class="col-md-4">
                                <div class="card h-100 rounded-4 border-0 shadow-sm"
                                    style="background: linear-gradient(180deg, #e8f5e9, #ffffff);">
                                    <div class="card-header bg-transparent border-0 text-success fw-semibold pb-0">
                                        <h5 class="fw-bold" style="font-size: 1.3rem;">⚙️ Edge Metricsss</h5>
                                    </div>
                                    <div class="card-body p-4">
                                        <p class="text-secondary small mt-3 border-top pt-3 fw-medium">Detailed Results
                                        </p>
                                        <ul class="list-group list-group-flush small"
                                            style="max-height: 200px; overflow-y: auto;">
                                            <template v-for="(item, index) in dialogData.results" :key="index">
                                                <li v-if="item.betterServer === 'Edge'" class="list-group-item d-flex justify-content-between
                                                    align-items-center p-2 border-0 bg-transparent">
                                                    <span class="fw-medium text-truncate">{{ item.id }}</span>
                                                    <span
                                                        class="badge rounded-pill text-bg-primary-subtle text-primary px-3 py-2">{{
                                                        item.edge }}</span>
                                                </li>
                                            </template>
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-4">
                                <table border="1" cellpadding="8" cellspacing="0"
                                    style="border-collapse: collapse; width: 100%; text-align: center;">
                                    <thead>
                                        <tr>
                                            <th rowspan="2">Metric</th>
                                            <th colspan="2">My Framework (Optimized)</th>
                                            <th colspan="2">DPTARA</th>
                                            <th colspan="2">3rd Framework</th>
                                            <th colspan="2">4th Framework</th>
                                        </tr>
                                        <tr>
                                            <th>Cloud ({{
                                                dialogData.unit }})</th>
                                            <th>Edge ({{
                                                dialogData.unit }})</th>
                                            <th>Cloud ({{
                                                dialogData.unit }})</th>
                                            <th>Edge ({{
                                                dialogData.unit }})</th>
                                            <th>Cloud ({{
                                                dialogData.unit }})</th>
                                            <th>Edge ({{
                                                dialogData.unit }})</th>
                                            <th>Cloud ({{
                                                dialogData.unit }})</th>
                                            <th>Edge ({{
                                                dialogData.unit }})</th>
                                        </tr>
                                    </thead>

                                    <tbody>
                                        <tr>
                                            <td><strong>Total </strong></td>
                                            <td>{{ dialogData.total.cloud }} </td>
                                            <td>{{ dialogData.total.edge }} </td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                        </tr>

                                        <tr>
                                            <td><strong>Average</strong></td>
                                            <td>{{ dialogData.averages.cloud }} </td>
                                            <td>{{ dialogData.averages.edge }} </td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                            <td>-</td>
                                        </tr>

                                        <tr>
                                            <td><strong>Overall Total</strong></td>
                                            <td colspan="2">

                                                <strong>{{ dialogData.total.cloud +
                                                    dialogData.total.edge }}</strong>
                                            </td>
                                            <td colspan="2">
                                            </td>
                                            <td colspan="2">
                                            </td>
                                            <td colspan="2">
                                            </td>
                                        </tr>

                                        <tr>
                                            <td><strong>Overall Average</strong></td>
                                            <td colspan="2">

                                                <strong>{{ (dialogData.averages.cloud + dialogData.averages.edge) / 2
                                                    }}</strong>
                                            </td>
                                            <td colspan="2">
                                            </td>
                                            <td colspan="2">
                                            </td>
                                            <td colspan="2">
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div style="height: 400px;">
                                <canvas ref="chartCanvas"></canvas>
                            </div>

                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="modal-footer justify-content-center py-3 border-0" style="background: #f1f5f9;">
                        <button type="button" class="btn btn-light text-secondary border rounded-pill px-4 py-2"
                            data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-1"></i> Close
                        </button>
                    </div>

                </div>
            </div>
        </div>

        <div class="modal fade" id="metricsModal2" tabindex="-1" role="dialog" aria-labelledby="metricsModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-fit-content" role="document">
                <div class="modal-content" v-if="overall">
                    <div class="modal-header">
                        <h5 class="modal-title" id="metricsModalLabel">Overall Average</h5>

                    </div>

                    <div class="modal-body p-4" style="background: #f8fafc;">
                        <div class="table-responsive shadow-sm rounded-4 overflow-hidden border border-gray-200">
                            <table class="table align-middle mb-0"
                                style="border-collapse: separate; border-spacing: 0;">
                                <thead style="background: linear-gradient(135deg, #007bff, #00b4d8); color: white;">
                                    <tr>
                                        <th class="fw-semibold py-3 px-3">Task ID</th>
                                        <th class="fw-semibold py-3 px-3">Transmission Time</th>
                                        <th class="fw-semibold py-3 px-3">Transmission Cost</th>
                                        <th class="fw-semibold py-3 px-3">Execution Time</th>
                                        <th class="fw-semibold py-3 px-3">Execution Cost</th>
                                        <th class="fw-semibold py-3 px-3">Waiting Time</th>
                                        <th class="fw-semibold py-3 px-3">Waiting Cost</th>
                                        <th class="fw-semibold py-3 px-3">Energy Usage</th>
                                        <th class="fw-semibold py-3 px-3">Energy Cost</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white">
                                    <tr v-for="row in overall" :key="row.taskId" class="hover-row">
                                        <td class="fw-medium py-3 px-3 text-primary-emphasis">{{ row.taskId }}</td>
                                        <td class="py-3 px-3 text-muted">{{ row.transmission_time }}</td>
                                        <td class="py-3 px-3 text-info fw-semibold">{{ row.transmission_cost }}</td>
                                        <td class="py-3 px-3 text-muted">{{ row.execution_time }}</td>
                                        <td class="py-3 px-3 text-success fw-semibold">{{ row.execution_cost }}</td>
                                        <td class="py-3 px-3 text-muted">{{ row.waiting_time }}</td>
                                        <td class="py-3 px-3 text-warning fw-semibold">{{ row.waiting_cost }}</td>
                                        <td class="py-3 px-3 text-muted">{{ row.energy_usage }}</td>
                                        <td class="py-3 px-3 text-danger fw-semibold">{{ row.energy_cost }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div>


        <div class="row">
            <div class="col m-5">
                <div class="row">
                    <div class="col">
                        <label for="formFileLg" class="form-label">Upload Reference Values</label>
                        <input class="form-control form-control-lg" id="formFileLg" type="file"
                            @change="handleFileUpload">
                    </div>
                </div>
                <hr>
                <div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Parameter</th>
                                <th>Age</th>
                                <th>Sex</th>
                                <th>Unit</th>
                                <th>Label</th>
                                <th>Value</th>
                                <th>Difference</th>
                                <th>Result</th>
                                <th>Expected Range</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template v-for="item in data" :key="item.key">
                                <tr v-for="(result, index) in item.results" :key="index">
                                    <td>{{ item.processed_parameter || item.measured_parameter }}</td>
                                    <td>{{ item.age }}</td>
                                    <td>{{ item.sex }}</td>
                                    <td>{{ result.unit || item.unit }}</td>
                                    <td>{{ result.label }}</td>
                                    <td>{{ result.value }}</td>
                                    <td>{{ result.difference }}</td>
                                    <td
                                        :class="{'text-warning fw-bold': result.result === 'hypo', 'text-success': result.result === 'normal', 'text-danger fw-bold': result.result === 'hyper',}">
                                        {{ result.result }}</td>
                                    <td>{{ result.expected_range ? Object.values(result.expected_range).join(' - ') : ''
                                        }}</td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            const { createApp, ref, onMounted } = Vue;

            createApp({
                setup() {
                    const data = ref(null);
                    const loading = ref(false);
                    const error = ref(null);
                    const dialogData = ref(null);
                    const transmission_time = ref(null);
                    const transmission_cost = ref(null);
                    const executions_metrics = ref(null);
                    const energy_usage = ref(null);
                    const energy_cost = ref(null);

                    const execution_cost = ref(null);
                    const execution_time = ref(null);

                    const waiting_metrics = ref(null);
                    const dialog_Heading = ref(null);
                    const overall = ref(null);
                    const totalFinalTransmissionCostCloud = ref(null);
                    const totalFinalTransmissionCostEdge = ref(null);
                    const vendorTotalVendorCost = ref(null);
                    const totalFinalTransmissionTimeCloud = ref(null);
                    const totalFinalTransmissionTimeEdge = ref(null);
                    const vendorTotalVendorTime = ref(null);
                    const averageFinalTransmissionTimeCloud = ref(null);
                    const averageFinalTransmissionTimeEdge = ref(null);
                    const averageTotalVendorTime = ref(null);
                    const chartCanvas = ref(null);

                    const handleFileUpload = async (event) => {
                        const file = event.target.files[0];
                        if (file) {
                            const formData = new FormData();
                            formData.append('file', file);
                            try {
                                const response = await axios.post('/edge-servers/upload-excel', formData, {
                                    headers: {
                                        'Content-Type': 'multipart/form-data'
                                    }
                                });
                                console.log(response.data, "response data from server");
                                data.value = response.data.health_parameter;
                                transmission_time.value = response.data.transmission_time;
                                transmission_cost.value = response.data.transmission_cost;
                                energy_cost.value = response.data.energy_cost;
                                energy_usage.value = response.data.energy_usage;

                                execution_cost.value = response.data.execution_cost;
                                execution_time.value = response.data.execution_time;

                                waiting_metrics.value = response.data.transmission_queuing_time;

                                totalFinalTransmissionCostCloud.value = response.data.transmission_cost.total.cloud;
                                totalFinalTransmissionCostEdge.value = response.data.transmission_cost.total.edge;
                                vendorTotalVendorCost.value = response.data.transmission_cost.total.vendor;

                                totalFinalTransmissionTimeCloud.value = response.data.transmission_time.total.cloud;
                                totalFinalTransmissionTimeEdge.value = response.data.transmission_time.total.edge;
                                vendorTotalVendorTime.value = response.data.transmission_time.total.vendor;

                                averageFinalTransmissionTimeCloud.value = response.data.transmission_time.averages.cloud;
                                averageFinalTransmissionTimeEdge.value = response.data.transmission_time.averages.edge;
                                averageTotalVendorTime.value = response.data.transmission_time.averages.vendor;

                                showOverall(response.data)
                            } catch (error) {
                                console.error('Error uploading file:', error);
                            }
                        }
                    };

                    const displayTransmissionTime = () => {
                        dialogData.value = transmission_time.value;
                        dialog_Heading.value = 'Transmission Time';

                        if (!transmission_time.value || !transmission_time.value.edge) {
                            console.error("Transmission time data not available");
                            return;
                        }

                        dialogData.value = transmission_time.value;
                        dialog_Heading.value = 'Transmission Time';

                        const edgeSubset = transmission_time.value.edge.slice(0, 10);
                        const cloudSubset = transmission_time.value.cloud.slice(0, 10);
                        const labels = edgeSubset.map(item => item.id);
                        const edgeData = edgeSubset.map(item => item.transmissionTime);
                        const cloudData = cloudSubset.map(item => item.transmissionTime);

                        console.log(edgeData, cloudData, labels, "data for transmission time chart");

                        setTimeout(() => {
                            renderChart(edgeData, cloudData, labels);
                        }, 200);
                    };

                    const displayTransmissionCost = () => {
                        dialogData.value = transmission_cost.value;
                        dialog_Heading.value = 'Transmission Cost';

                        if (!transmission_cost.value || !transmission_cost.value.edge) {
                            console.error("Transmission cost data not available");
                            return;
                        }

                        dialogData.value = transmission_cost.value;
                        dialog_Heading.value = 'Transmission Cost';

                        const edgeSubset = transmission_cost.value.edge.slice(0, 10);
                        const cloudSubset = transmission_cost.value.cloud.slice(0, 10);
                        const labels = edgeSubset.map(item => item.id);
                        const edgeData = edgeSubset.map(item => item.transmissionCost);
                        const cloudData = cloudSubset.map(item => item.transmissionCost);

                        console.log(edgeData, cloudData, labels, "data for transmission cost chart");

                        setTimeout(() => {
                            renderChart(edgeData, cloudData, labels);
                        }, 200);
                    };

                    const displayExecutionsMetricsTime = () => {
                        if (!execution_time.value || !execution_time.value.edge) {
                            console.error("Execution time data not available");
                            return;
                        }

                        dialogData.value = execution_time.value;
                        dialog_Heading.value = 'Execution Time';

                        const edgeSubset = execution_time.value.edge.slice(0, 10);
                        const cloudSubset = execution_time.value.cloud.slice(0, 10);
                        const labels = edgeSubset.map(item => item.id);
                        const edgeData = edgeSubset.map(item => item.executionTime);
                        const cloudData = cloudSubset.map(item => item.executionTime);

                        setTimeout(() => {
                            renderChart(edgeData, cloudData, labels);
                        }, 200);
                    };

                    const displayExecutionsMetricsCost = () => {

                        if (!execution_cost.value || !execution_cost.value.edge) {
                            console.error("Execution cost data not available");
                            return;
                        }

                        dialogData.value = execution_cost.value;
                        dialog_Heading.value = 'Execution Cost';

                        const edgeSubset = execution_cost.value.edge.slice(0, 10);
                        const cloudSubset = execution_cost.value.cloud.slice(0, 10);
                        const labels = edgeSubset.map(item => item.id);
                        const edgeData = edgeSubset.map(item => item.executionCost);
                        const cloudData = cloudSubset.map(item => item.executionCost);

                        setTimeout(() => {
                            renderChart(edgeData, cloudData, labels);
                        }, 200);

                    };

                    const displayEnergyUsage = () => {
                        if (!energy_usage.value || !energy_usage.value.edge) {
                            console.error("Energy data not available");
                            return;
                        }

                        dialogData.value = energy_usage.value;
                        dialog_Heading.value = 'Energy Usage';

                        const edgeSubset = energy_usage.value.edge.slice(0, 10);
                        const cloudSubset = energy_usage.value.cloud.slice(0, 10);

                        const labels = edgeSubset.map(item => item.id);
                        const edgeData = edgeSubset.map(item => item.energyUsage);
                        const cloudData = cloudSubset.map(item => item.energyUsage);

                        setTimeout(() => {
                            renderChart(edgeData, cloudData, labels);
                        }, 200);
                    };

                    const displayEnergyCost = () => {
                        if (!energy_cost.value || !energy_cost.value.edge) {
                            console.error("Energy cost data not available");
                            return;
                        }

                        dialogData.value = energy_cost.value;
                        dialog_Heading.value = 'Energy Cost';

                        const edgeSubset = energy_cost.value.edge.slice(0, 10);
                        const cloudSubset = energy_cost.value.cloud.slice(0, 10);
                        const labels = edgeSubset.map(item => item.id);
                        const edgeData = edgeSubset.map(item => item.cost);
                        const cloudData = cloudSubset.map(item => item.cost);

                        setTimeout(() => {
                            renderChart(edgeData, cloudData, labels);
                        }, 200);
                    };

                    // New function for Waiting Time
                    const displayWaitingTime = () => {
                        if (!waiting_metrics.value) return;

                        const waitingTimeData = JSON.parse(JSON.stringify(waiting_metrics.value));

                        waitingTimeData.results.forEach(result => {
                            result.edge = result.edge.wait;
                            result.cloud = result.cloud.wait;
                        });

                        // waitingTimeData.averages.edge = waiting_metrics.value.averages.edge.time;
                        // waitingTimeData.averages.cloud = waiting_metrics.value.averages.cloud.time;
                        // waitingTimeData.total.edge = waiting_metrics.value.totals.edge.time;
                        // waitingTimeData.total.cloud = waiting_metrics.value.totals.cloud.time;
                        waitingTimeData.unit = waiting_metrics.value.unit.time;

                        dialogData.value = waitingTimeData;
                        dialog_Heading.value = 'Waiting Time';
                    };

                    // New function for Waiting Cost
                    const displayWaitingCost = () => {
                        if (!waiting_metrics.value) return;

                        const waitingCostData = JSON.parse(JSON.stringify(waiting_metrics.value));

                        waitingCostData.results.forEach(result => {
                            result.edge = result.edge.cost;
                            result.cloud = result.cloud.cost;
                        });

                        // waitingCostData.averages.edge = waiting_metrics.value.averages.edge.cost;
                        // waitingCostData.averages.cloud = waiting_metrics.value.averages.cloud.cost;
                        // waitingCostData.total.edge = waiting_metrics.value.totals.edge.cost;
                        // waitingCostData.total.cloud = waiting_metrics.value.totals.cloud.cost;
                        waitingCostData.unit = waiting_metrics.value.unit.cost;

                        dialogData.value = waitingCostData;
                        dialog_Heading.value = 'Waiting Cost';
                    };


                    showOverall = (data) => {
                        const rows = [];

                        data.health_parameter.forEach((param, index) => {
                            const taskId = `task-${index + 1}-${param.key}`;


                            // transmission_time
                            const transTime = data.transmission_time.results.find(r => r.id === taskId);
                            const transCost = data.transmission_cost.results.find(r => r.id === taskId);
                            const queueTime = data.transmission_queuing_time.results.find(r => r.id === taskId);
                            const exec = data.executions_metrics.results.find(r => r.id === taskId);
                            const energy = data.energy_usage_and_cost.results.find(r => r.id === taskId);

                            if (transTime && transCost && queueTime && exec && energy) {
                                rows.push({
                                    taskId: taskId,
                                    transmission_time: `${transTime.edge} s (Edge) / ${transTime.cloud} s (Cloud)`,
                                    transmission_cost: `${transCost.edge} USD (Edge) / ${transCost.cloud} USD (Cloud)`,
                                    execution_time: `${exec.edge.execTime} s (Edge) / ${exec.cloud.execTime} s (Cloud)`,
                                    execution_cost: `${exec.edge.cost} (Edge) / ${exec.cloud.cost} (Cloud)`,
                                    waiting_time: `${queueTime.edge.wait} s (Edge) / ${queueTime.cloud.wait} s (Cloud)`,
                                    waiting_cost: `${queueTime.edge.cost} USD (Edge) / ${queueTime.cloud.cost} USD (Cloud)`,
                                    energy_usage: `${energy.edge.energyUsed} kWh (Edge) / ${energy.cloud.energyUsed} kWh (Cloud)`,
                                    energy_cost: `${energy.edge.energyCost} USD (Edge) / ${energy.cloud.energyCost} USD (Cloud)`
                                });
                            }
                        });

                        overall.value = rows
                        // return rows;
                    }

                    // Add a variable to store the chart instance (to prevent duplicates)
                    let myChartInstance = null;

                    onMounted(() => {
                        // console.log(chartCanvas.value, "chartCanvas");
                        // if (chartCanvas.value) {
                        //     renderChart();
                        // }
                    });

                    const renderChart = (edgeData, cloudData, labels) => {

                        console.log(edgeData, cloudData, "data in renderChart function");



                        if (chartCanvas.value) {
                            if (myChartInstance) {
                                myChartInstance.destroy();
                            }

                            myChartInstance = new Chart(chartCanvas.value, {
                                type: 'line',
                                data: {
                                    labels: labels,
                                    datasets: [
                                        {
                                            label: 'Edge Computing (Dynamic)',
                                            data: edgeData,
                                            borderColor: '#10b981',
                                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                            borderWidth: 3,
                                            tension: 0.4,
                                            pointRadius: 4,
                                            fill: true
                                        },
                                        {
                                            label: 'Cloud Computing (Dynamic)',
                                            data: cloudData,
                                            borderColor: '#3b82f6',
                                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                            borderWidth: 3,
                                            tension: 0.4,
                                            pointRadius: 4,
                                            fill: true
                                        }
                                    ]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: true,
                                    plugins: {
                                        legend: { position: 'top' },
                                        tooltip: { mode: 'index', intersect: false }
                                    },
                                    scales: {
                                        y: {
                                            beginAtZero: true,
                                            title: { display: true, text: 'Processing Time (s)' },
                                            grid: { color: 'rgba(0,0,0,0.05)' }
                                        },
                                        x: {
                                            grid: { display: false }
                                        }
                                    }
                                }
                            });
                        }
                    };




                    return {
                        data,
                        loading,
                        error,
                        energy_usage,
                        energy_cost,

                        execution_cost,
                        execution_time,

                        handleFileUpload,
                        displayTransmissionTime,
                        displayTransmissionCost,
                        displayExecutionsMetricsTime,
                        displayExecutionsMetricsCost,
                        displayEnergyUsage,
                        displayEnergyCost,
                        displayWaitingTime,
                        displayWaitingCost,
                        dialogData,
                        overall,
                        dialog_Heading,
                        showOverall,
                        totalFinalTransmissionCostCloud,
                        totalFinalTransmissionCostEdge,
                        vendorTotalVendorCost,
                        totalFinalTransmissionTimeCloud,
                        totalFinalTransmissionTimeEdge,
                        vendorTotalVendorTime,
                        chartCanvas,
                        averageFinalTransmissionTimeCloud,
                        averageFinalTransmissionTimeEdge,
                        averageTotalVendorTime
                    };
                }
            }).mount('#app');
        </script>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
        crossorigin="anonymous"></script>

</body>

</html>